"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function translateXY(t,e,r,s){void 0===s&&(s=0),t&&(t.style.opacity="1",t.style.transitionDuration=s+"ms",t.style.webkitTransitionDuration=s+"ms",t.style.transfrom="translate("+e+"px, "+r+"px)",t.style.webkitTransform="translate("+e+"px, "+r+"px) translateZ(0)")}function objectAssign(t){for(var e=arguments,r=Object(t),s=1;s<arguments.length;s++){var i=e[s];if(void 0!==i&&null!==i)for(var a in i)i.hasOwnProperty(a)&&(r[a]=i[a])}return r}var React=_interopDefault(require("react")),PropTypes=_interopDefault(require("prop-types")),styles={wrapper:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},frame:{width:"100%",height:"100%",position:"absolute"}},Carousel=function(t){function e(e){t.call(this,e),this.state={frames:[].concat(e.frames||e.children||[]),current:0},this.mounted=!1,this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.autoSlide=this.autoSlide.bind(this),this.prev=this.prev.bind(this),this.next=this.next.bind(this),!1===e.loop&&e.auto&&console.warn("[re-carousel] Auto-slide only works in loop mode.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.componentDidMount=function(){var t=this;this.mounted=!0,this.prepareAutoSlide();for(var e=1;e<this.state.frames.length;e++)t.refs["f"+e].style.opacity=0},e.prototype.componentWillUnmount=function(){this.mounted=!1,this.clearAutoTimeout()},e.prototype.onTouchStart=function(t){if(!(this.state.total<2)){this.clearAutoTimeout(),this.updateFrameSize(),this.prepareSiblingFrames();var e=t.touches&&t.touches[0]||t,r=e.pageX,s=e.pageY;this.setState({startX:r,startY:s,deltaX:0,deltaY:0}),this.refs.wrapper.addEventListener("touchmove",this.onTouchMove,{passive:!0}),this.refs.wrapper.addEventListener("mousemove",this.onTouchMove,{passive:!0}),this.refs.wrapper.addEventListener("touchend",this.onTouchEnd,!0),this.refs.wrapper.addEventListener("mouseup",this.onTouchEnd,!0)}},e.prototype.onTouchMove=function(t){if(!(t.touches&&t.touches.length>1)){this.clearAutoTimeout();var e=t.touches&&t.touches[0]||t,r=e.pageX,s=e.pageY,i=r-this.state.startX,a=s-this.state.startY;this.setState({deltaX:i,deltaY:a}),this.props.loop||(this.state.current===this.state.frames.length-1&&(i<0&&(i/=3),a<0&&(a/=3)),0===this.state.current&&(i>0&&(i/=3),a>0&&(a/=3))),this.moveFramesBy(i,a)}},e.prototype.onTouchEnd=function(){var t=this,e=this.decideEndPosition();e&&this.transitFramesTowards(e),this.refs.wrapper.removeEventListener("touchmove",this.onTouchMove),this.refs.wrapper.removeEventListener("mousemove",this.onTouchMove),this.refs.wrapper.removeEventListener("touchend",this.onTouchEnd,!0),this.refs.wrapper.removeEventListener("mouseup",this.onTouchEnd,!0),setTimeout(function(){return t.prepareAutoSlide()},this.props.duration)},e.prototype.decideEndPosition=function(){var t=this.state,e=t.deltaX;void 0===e&&(e=0);var r=t.deltaY;void 0===r&&(r=0);var s=t.current,i=t.frames,a=this.props,o=a.axis,n=a.loop,p=a.minMove;switch(o){case"x":if(!1===n){if(0===s&&e>0)return"origin";if(s===i.length-1&&e<0)return"origin"}return Math.abs(e)<p?"origin":e>0?"right":"left";case"y":if(!1===n){if(0===s&&r>0)return"origin";if(s===i.length-1&&r<0)return"origin"}return Math.abs(r)<p?"origin":r>0?"down":"up"}},e.prototype.moveFramesBy=function(t,e){var r=this.state.movingFrames,s=r.prev,i=r.current,a=r.next,o=this.state,n=o.frameWidth,p=o.frameHeight;switch(this.props.axis){case"x":translateXY(i,t,0),t<0?translateXY(a,t+n,0):translateXY(s,t-n,0);break;case"y":translateXY(i,0,e),e<0?translateXY(a,0,e+p):translateXY(s,0,e-p)}},e.prototype.prepareAutoSlide=function(){var t=this;if(!(this.state.frames.length<2)&&(this.clearAutoTimeout(),this.updateFrameSize(function(){t.prepareSiblingFrames()}),this.mounted&&this.props.loop&&this.props.auto)){var e=setTimeout(this.autoSlide,this.props.interval);this.setState({slider:e})}},e.prototype.autoSlide=function(t){var e=this;switch(this.clearAutoTimeout(),t){case"prev":this.transitFramesTowards("x"===this.props.axis?"right":"down");break;case"next":default:this.transitFramesTowards("x"===this.props.axis?"left":"up")}setTimeout(function(){return e.prepareAutoSlide()},this.props.duration)},e.prototype.next=function(){var t=this.state,e=t.current,r=t.frames;if(!this.props.loop&&e===r.length-1)return!1;this.autoSlide("next")},e.prototype.prev=function(){if(!this.props.loop&&0===this.state.current)return!1;this.autoSlide("prev")},e.prototype.clearAutoTimeout=function(){clearTimeout(this.state.slider)},e.prototype.updateFrameSize=function(t){var e=window.getComputedStyle(this.refs.wrapper),r=e.width,s=e.height;this.setState({frameWidth:parseFloat(r.split("px")[0]),frameHeight:parseFloat(s.split("px")[0])},t)},e.prototype.prepareSiblingFrames=function(){var t={current:this.refs["f"+this.getFrameId()],prev:this.refs["f"+this.getFrameId("prev")],next:this.refs["f"+this.getFrameId("next")]};return this.props.loop||(0===this.state.current&&(t.prev=void 0),this.state.current===this.state.frames.length-1&&(t.next=void 0)),this.setState({movingFrames:t}),translateXY(t.current,0,0),"x"===this.props.axis?(translateXY(t.prev,-this.state.frameWidth,0),translateXY(t.next,this.state.frameWidth,0)):(translateXY(t.prev,0,-this.state.frameHeight),translateXY(t.next,0,this.state.frameHeight)),t},e.prototype.getFrameId=function(t){var e=this.state,r=e.frames,s=e.current,i=r.length;switch(t){case"prev":return(s-1+i)%i;case"next":return(s+1)%i;default:return s}},e.prototype.transitFramesTowards=function(t){var e=this.state.movingFrames,r=e.prev,s=e.current,i=e.next,a=this.props,o=a.duration,n=a.axis,p=this.state.current;switch(t){case"up":translateXY(s,0,-this.state.frameHeight,o),translateXY(i,0,0,o),p=this.getFrameId("next");break;case"down":translateXY(s,0,this.state.frameHeight,o),translateXY(r,0,0,o),p=this.getFrameId("prev");break;case"left":translateXY(s,-this.state.frameWidth,0,o),translateXY(i,0,0,o),p=this.getFrameId("next");break;case"right":translateXY(s,this.state.frameWidth,0,o),translateXY(r,0,0,o),p=this.getFrameId("prev");break;default:translateXY(s,0,0,o),"x"===n?(translateXY(r,-this.state.frameWidth,0,o),translateXY(i,this.state.frameWidth,0,o)):"y"===n&&(translateXY(r,0,-this.state.frameHeight,o),translateXY(i,0,this.state.frameHeight,o))}this.setState({current:p})},e.prototype.render=function(){var t=this,e=this.state,r=e.frames,s=e.current,i=this.props,a=i.widgets,o=i.axis,n=i.loop,p=i.auto,h=i.interval;return React.createElement("div",{ref:"wrapper",style:objectAssign(styles.wrapper,this.props.style),onTouchStart:this.onTouchStart,onMouseDown:this.onTouchStart},r.map(function(t,e){var r=objectAssign({zIndex:99-e},styles.frame);return React.createElement("div",{ref:"f"+e,key:e,style:r},t)}),a&&[].concat(a).map(function(e,i){return React.createElement(e,{key:i,index:s,total:r.length,prevHandler:t.prev,nextHandler:t.next,axis:o,loop:n,auto:p,interval:h})}),this.props.frames&&this.props.children)},e}(React.Component);Carousel.propTypes={axis:PropTypes.oneOf(["x","y"]),auto:PropTypes.bool,loop:PropTypes.bool,interval:PropTypes.number,duration:PropTypes.number,widgets:PropTypes.arrayOf(PropTypes.func),frames:PropTypes.arrayOf(PropTypes.element),style:PropTypes.object,minMove:PropTypes.number},Carousel.defaultProps={axis:"x",auto:!1,loop:!1,interval:5e3,duration:300,minMove:42},module.exports=Carousel;
